2025-05-13 11:12:37,749 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 11:12:37,753 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 11:12:37,754 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 11:12:37,756 - CatastoDBLogger - ERROR - Errore di connessione al database: invalid dsn: invalid connection option "schema"
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 27, in connect
    self.conn = psycopg2.connect(**self.db_config)
                ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    ~~~~~~~~~^^^^^
psycopg2.ProgrammingError: invalid dsn: invalid connection option "schema"

2025-05-13 11:12:37,770 - CatastoAppLogger - CRITICAL - Fallimento connessione al database all'avvio. L'applicazione terminerà.
2025-05-13 11:14:48,817 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 11:14:48,818 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 11:14:48,819 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 11:14:48,819 - CatastoDBLogger - ERROR - Errore di connessione al database: invalid dsn: invalid connection option "schema"
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 27, in connect
    self.conn = psycopg2.connect(**self.db_config)
                ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    ~~~~~~~~~^^^^^
psycopg2.ProgrammingError: invalid dsn: invalid connection option "schema"

2025-05-13 11:14:48,833 - CatastoAppLogger - CRITICAL - Fallimento connessione al database all'avvio. L'applicazione terminerà.
2025-05-13 11:22:14,558 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 11:22:14,561 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 11:22:14,561 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 11:22:14,661 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 11:22:14,673 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 11:22:14,674 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 11:22:40,239 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: Saintgold
2025-05-13 11:22:40,261 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, password_hash, role_id, is_active FROM utenti WHERE username = %s... Errore: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id, password_hash, role_id, is_active FROM utenti WHE...
                                                          ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id, password_hash, role_id, is_active FROM utenti WHE...
                                                          ^

2025-05-13 11:22:40,277 - CatastoAppLogger - ERROR - Errore durante il tentativo di login: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id, password_hash, role_id, is_active FROM utenti WHE...
                                                          ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 95, in authenticate_user
    user_id, role_id, session_id, message = utenti_service.login_user_service(
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        db_manager_instance, username, password, client_ip_address
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 129, in login_user_service
    user_data = db_manager.execute_query(query, (username,), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id, password_hash, role_id, is_active FROM utenti WHE...
                                                          ^

2025-05-13 11:24:05,551 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: Saintgold
2025-05-13 11:24:05,566 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id FROM utenti WHERE username = %s OR email = %s... Errore: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:24:05,569 - CatastoAppLogger - ERROR - Errore critico durante la registrazione: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 137, in authenticate_user
    new_user_id = utenti_service.register_user_service(
        db_manager_instance, username_reg, password_reg1, email_reg,
        DEFAULT_SELF_REGISTER_ROLE_ID, client_ip_address=client_ip_address,
        created_by_user_id=None # Self-registration
    )
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 51, in register_user_service
    existing_user = db_manager.execute_query(check_query, (username, email), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:25:22,451 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-13 11:25:22,452 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 11:42:57,829 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 11:42:57,832 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 11:42:57,832 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 11:42:57,939 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 11:42:57,943 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 11:42:57,945 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 11:43:20,765 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: Saintgold
2025-05-13 11:43:20,790 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id FROM utenti WHERE username = %s OR email = %s... Errore: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id FROM utenti WHERE username = 'Saintgold' OR email ...
                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id FROM utenti WHERE username = 'Saintgold' OR email ...
                       ^

2025-05-13 11:43:20,816 - CatastoAppLogger - ERROR - Errore critico durante la registrazione: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id FROM utenti WHERE username = 'Saintgold' OR email ...
                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 137, in authenticate_user
    new_user_id = utenti_service.register_user_service(
        db_manager_instance, username_reg, password_reg1, email_reg,
        DEFAULT_SELF_REGISTER_ROLE_ID, client_ip_address=client_ip_address,
        created_by_user_id=None # Self-registration
    )
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 51, in register_user_service
    existing_user = db_manager.execute_query(check_query, (username, email), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "utenti" non esiste
LINE 1: SELECT id FROM utenti WHERE username = 'Saintgold' OR email ...
                       ^

2025-05-13 11:44:05,351 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: 0
2025-05-13 11:44:05,353 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, password_hash, role_id, is_active FROM utenti WHERE username = %s... Errore: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:44:05,359 - CatastoAppLogger - ERROR - Errore durante il tentativo di login: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 95, in authenticate_user
    user_id, role_id, session_id, message = utenti_service.login_user_service(
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        db_manager_instance, username, password, client_ip_address
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 129, in login_user_service
    user_data = db_manager.execute_query(query, (username,), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:44:09,193 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-13 11:44:09,194 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 11:52:21,988 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 11:52:21,991 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 11:52:21,991 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 11:52:22,085 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 11:52:22,086 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 11:52:22,088 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 11:52:43,792 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: Saintgold
2025-05-13 11:52:44,143 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO utenti (username, password_hash, email, role_id, is_active, created_at, updated_at)
        VALUES (%s, %s, %s, %s, TRUE, NOW(), NOW()) RETURNING id
    ... Errore: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).

2025-05-13 11:52:44,177 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-13 11:52:44,177 - CatastoAppLogger.UtentiService - ERROR - Errore critico durante la registrazione dell'utente 'Saintgold': ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).

2025-05-13 11:52:44,188 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 11:52:44,193 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User None, Azione 'REGISTER_USER_FAIL'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 11:52:44,202 - CatastoAppLogger - ERROR - Errore critico durante la registrazione: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 137, in authenticate_user
    new_user_id = utenti_service.register_user_service(
        db_manager_instance, username_reg, password_reg1, email_reg,
        DEFAULT_SELF_REGISTER_ROLE_ID, client_ip_address=client_ip_address,
        created_by_user_id=None # Self-registration
    )
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (1, Saintgold, $2b$12$/q0f5CswhXNRIIOlPkdHIeugNXij28bXkkFKLMy/WSqaeXRGpKdUu, null, sa@gm.com, t, null, 2025-05-13 11:52:22.085472, 2025-05-13 11:52:22.085472, 2).

2025-05-13 11:53:46,254 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: Saintgold
2025-05-13 11:53:46,255 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id FROM utenti WHERE username = %s OR email = %s... Errore: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:53:46,270 - CatastoAppLogger - ERROR - Errore critico durante la registrazione: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 137, in authenticate_user
    new_user_id = utenti_service.register_user_service(
        db_manager_instance, username_reg, password_reg1, email_reg,
        DEFAULT_SELF_REGISTER_ROLE_ID, client_ip_address=client_ip_address,
        created_by_user_id=None # Self-registration
    )
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 51, in register_user_service
    existing_user = db_manager.execute_query(check_query, (username, email), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 180, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: ERRORE:  la transazione corrente è interrotta, i comandi saranno ignorati fino alla fine del blocco della transazione

2025-05-13 11:56:26,299 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-13 11:56:26,300 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 12:02:29,828 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 12:02:29,831 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 12:02:29,831 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 12:02:29,924 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 12:02:29,926 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 12:02:29,928 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 12:02:47,182 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: sa
2025-05-13 12:02:47,583 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO utenti (username, password_hash, email, role_id, is_active, created_at, updated_at)
        VALUES (%s, %s, %s, %s, TRUE, NOW(), NOW()) RETURNING id
    ... Errore: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).

2025-05-13 12:02:47,604 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-13 12:02:47,604 - CatastoAppLogger.UtentiService - ERROR - Errore critico durante la registrazione dell'utente 'sa': ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).

2025-05-13 12:02:47,615 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:02:47,620 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User None, Azione 'REGISTER_USER_FAIL'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:02:47,630 - CatastoAppLogger - ERROR - Errore critico durante la registrazione: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 137, in authenticate_user
    new_user_id = utenti_service.register_user_service(
        db_manager_instance, username_reg, password_reg1, email_reg,
        DEFAULT_SELF_REGISTER_ROLE_ID, client_ip_address=client_ip_address,
        created_by_user_id=None # Self-registration
    )
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 100, in register_user_service
    user_record = db_manager.execute_query(insert_query, (username, hashed_pw_str_for_db, email, role_id), fetch_one=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: ERRORE:  il valore nullo nella colonna "nome_completo" della relazione "utenti" viola il vincolo non nullo
DETAIL:  La riga in errore contiene (2, sa, $2b$12$hv1E66ERk3hTzFds2Z5gieMpJf4crP1Q7WOPkTv7.a5VqE.t5pgpG, null, sa@sa.com, t, null, 2025-05-13 12:02:47.555138, 2025-05-13 12:02:47.555138, 2).

2025-05-13 12:56:58,074 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 12:56:58,079 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 12:56:58,079 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 12:56:58,201 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 12:56:58,210 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 12:56:58,212 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 12:57:14,136 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: sa
2025-05-13 12:57:15,224 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) registrato con successo.
2025-05-13 12:57:15,240 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:57:15,287 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'REGISTER_USER_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:57:32,603 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-13 12:57:33,584 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 19dbd7e0-2d92-426a-a138-a200b12cbbab
2025-05-13 12:57:33,586 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:57:33,590 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:57:33,595 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 19dbd7e0-2d92-426a-a138-a200b12cbbab
2025-05-13 12:57:33,595 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 19dbd7e0-2d92-426a-a138-a200b12cbbab) ha effettuato l'accesso al menu principale.
2025-05-13 12:57:43,552 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:57:43,558 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:57:48,361 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 67, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-13 12:57:56,332 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:57:56,337 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:58:02,941 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 67, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-13 12:58:11,657 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:58:11,664 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:58:16,305 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 67, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-13 12:58:42,698 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:58:42,704 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:58:45,145 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 67, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-13 12:59:09,014 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: get_comuni_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 67, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: get_comuni_service() got an unexpected keyword argument 'current_user_id'
2025-05-13 12:59:26,307 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:59:26,313 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:59:35,932 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:59:35,937 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-13 12:59:50,363 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 19dbd7e0-2d92-426a-a138-a200b12cbbab...
2025-05-13 12:59:50,364 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 19dbd7e0-2d92-426a-a138-a200b12cbbab
2025-05-13 12:59:50,404 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 19dbd7e0-2d92-426a-a138-a200b12cbbab registrato con successo.
2025-05-13 12:59:50,406 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:59:50,413 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 12:59:50,419 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-13 12:59:50,420 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 12:59:50,421 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-13 13:31:35,893 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 13:31:35,898 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 13:31:35,899 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 13:31:35,987 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 13:31:35,997 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 13:31:35,998 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 13:31:50,061 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-13 13:31:51,022 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32
2025-05-13 13:31:51,037 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:31:51,059 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:31:51,065 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32
2025-05-13 13:31:51,066 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32) ha effettuato l'accesso al menu principale.
2025-05-13 13:31:51,067 - CatastoAppLogger - ERROR - Errore non gestito nel ciclo principale dell'applicazione: name 'ADMIN_ROLE_ID' is not defined
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 209, in main
    menu_principale(db, logged_in_user_id, current_user_role_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 936, in menu_principale
    if current_user_role_id == ADMIN_ROLE_ID:
                               ^^^^^^^^^^^^^
NameError: name 'ADMIN_ROLE_ID' is not defined
2025-05-13 13:31:51,082 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32...
2025-05-13 13:31:51,082 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32
2025-05-13 13:31:51,086 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 8a4b6eba-10b2-4f1c-ad0b-0cc42a59fa32 registrato con successo.
2025-05-13 13:31:51,088 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:31:51,092 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:31:51,097 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-13 13:31:51,097 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 13:31:51,097 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-13 13:31:58,397 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 13:31:58,399 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 13:31:58,399 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 13:31:58,613 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 13:31:58,614 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 13:31:58,616 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 13:32:07,273 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-13 13:32:08,243 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: f77b6713-1e66-42d8-8f7b-3da9bebc9adc
2025-05-13 13:32:08,248 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:32:08,275 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:32:08,284 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione f77b6713-1e66-42d8-8f7b-3da9bebc9adc
2025-05-13 13:32:08,284 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: f77b6713-1e66-42d8-8f7b-3da9bebc9adc) ha effettuato l'accesso al menu principale.
2025-05-13 13:32:08,286 - CatastoAppLogger - ERROR - Errore non gestito nel ciclo principale dell'applicazione: name 'ADMIN_ROLE_ID' is not defined
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 209, in main
    menu_principale(db, logged_in_user_id, current_user_role_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 936, in menu_principale
    if current_user_role_id == ADMIN_ROLE_ID:
                               ^^^^^^^^^^^^^
NameError: name 'ADMIN_ROLE_ID' is not defined
2025-05-13 13:32:08,309 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione f77b6713-1e66-42d8-8f7b-3da9bebc9adc...
2025-05-13 13:32:08,310 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: f77b6713-1e66-42d8-8f7b-3da9bebc9adc
2025-05-13 13:32:08,312 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione f77b6713-1e66-42d8-8f7b-3da9bebc9adc registrato con successo.
2025-05-13 13:32:08,313 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:32:08,317 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:32:08,323 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-13 13:32:08,324 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 13:32:08,324 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-13 13:32:22,546 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-13 13:32:22,547 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-13 13:32:22,548 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-13 13:32:22,620 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-13 13:32:22,621 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-13 13:32:22,623 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-13 13:32:49,305 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: pippo
2025-05-13 13:32:50,314 - CatastoAppLogger.UtentiService - INFO - Utente 'pippo' (ID: 4) registrato con successo.
2025-05-13 13:32:50,319 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:32:50,345 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 4, Azione 'REGISTER_USER_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:33:01,326 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: pippo
2025-05-13 13:33:02,243 - CatastoAppLogger.UtentiService - INFO - Utente 'pippo' (ID: 4) loggato con successo. Sessione: 98986337-2c57-46d5-bc7d-18554080e248
2025-05-13 13:33:02,245 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:33:02,250 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 4, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:33:02,256 - CatastoAppLogger - INFO - Login successo per utente ID 4, Ruolo ID 2, Sessione 98986337-2c57-46d5-bc7d-18554080e248
2025-05-13 13:33:02,256 - CatastoAppLogger.MenuHandler - INFO - Utente ID 4 (Ruolo ID: 2, Sessione: 98986337-2c57-46d5-bc7d-18554080e248) ha effettuato l'accesso al menu principale.
2025-05-13 13:33:02,257 - CatastoAppLogger - ERROR - Errore non gestito nel ciclo principale dell'applicazione: name 'ADMIN_ROLE_ID' is not defined
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 209, in main
    menu_principale(db, logged_in_user_id, current_user_role_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 936, in menu_principale
    if current_user_role_id == ADMIN_ROLE_ID:
                               ^^^^^^^^^^^^^
NameError: name 'ADMIN_ROLE_ID' is not defined
2025-05-13 13:33:02,275 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 4, sessione 98986337-2c57-46d5-bc7d-18554080e248...
2025-05-13 13:33:02,275 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 4, Sessione: 98986337-2c57-46d5-bc7d-18554080e248
2025-05-13 13:33:02,277 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 4, Sessione 98986337-2c57-46d5-bc7d-18554080e248 registrato con successo.
2025-05-13 13:33:02,278 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:33:02,282 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 4, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-13 13:33:02,288 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-13 13:33:02,289 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-13 13:33:02,289 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 08:12:39,938 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 08:12:39,942 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 08:12:39,942 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 08:12:40,156 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 08:12:40,164 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 08:12:40,166 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 08:12:45,267 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 08:12:45,781 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 3809a20a-9f40-44f1-85fb-0529f30c00e9
2025-05-14 08:12:45,793 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-14 08:12:45,831 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-14 08:12:45,837 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 3809a20a-9f40-44f1-85fb-0529f30c00e9
2025-05-14 08:12:45,837 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 3809a20a-9f40-44f1-85fb-0529f30c00e9) ha effettuato l'accesso al menu principale.
2025-05-14 08:12:45,838 - CatastoAppLogger - ERROR - Errore non gestito nel ciclo principale dell'applicazione: name 'ADMIN_ROLE_ID' is not defined
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 209, in main
    menu_principale(db, logged_in_user_id, current_user_role_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 936, in menu_principale
    if current_user_role_id == ADMIN_ROLE_ID:
                               ^^^^^^^^^^^^^
NameError: name 'ADMIN_ROLE_ID' is not defined
2025-05-14 08:12:45,853 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 3809a20a-9f40-44f1-85fb-0529f30c00e9...
2025-05-14 08:12:45,854 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 3809a20a-9f40-44f1-85fb-0529f30c00e9
2025-05-14 08:12:45,858 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 3809a20a-9f40-44f1-85fb-0529f30c00e9 registrato con successo.
2025-05-14 08:12:45,858 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
        ... Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-14 08:12:45,861 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (user_id, session_id, client_i...
                                       ^

2025-05-14 08:12:45,864 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 08:12:45,865 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 08:12:45,865 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 08:32:48,296 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 08:32:48,300 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 08:32:48,300 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 08:32:48,394 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 08:32:48,395 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 08:32:48,396 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 08:32:52,771 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 08:32:53,188 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 459195b8-45ba-4cbc-9270-c71e730d4938
2025-05-14 08:32:53,200 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
    ... Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:32:53,218 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:32:53,224 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 459195b8-45ba-4cbc-9270-c71e730d4938
2025-05-14 08:32:53,224 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 459195b8-45ba-4cbc-9270-c71e730d4938) ha effettuato l'accesso al menu principale.
2025-05-14 08:33:06,010 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-14 08:33:06,014 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-14 08:33:16,040 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 70, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-14 08:33:35,480 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 459195b8-45ba-4cbc-9270-c71e730d4938...
2025-05-14 08:33:35,481 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 459195b8-45ba-4cbc-9270-c71e730d4938
2025-05-14 08:33:35,486 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 459195b8-45ba-4cbc-9270-c71e730d4938 registrato con successo.
2025-05-14 08:33:35,487 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
    ... Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:33:35,489 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:33:35,494 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 08:33:35,495 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 08:33:35,495 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 08:33:42,383 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 08:33:42,385 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 08:33:42,385 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 08:33:42,450 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 08:33:42,451 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 08:33:42,453 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 08:33:48,914 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 08:33:49,272 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: d80ae985-57b5-4c3f-b419-b6ad6ea37f6f
2025-05-14 08:33:49,275 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
    ... Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:33:49,291 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:33:49,299 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione d80ae985-57b5-4c3f-b419-b6ad6ea37f6f
2025-05-14 08:33:49,299 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: d80ae985-57b5-4c3f-b419-b6ad6ea37f6f) ha effettuato l'accesso al menu principale.
2025-05-14 08:36:47,271 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione d80ae985-57b5-4c3f-b419-b6ad6ea37f6f...
2025-05-14 08:36:47,272 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: d80ae985-57b5-4c3f-b419-b6ad6ea37f6f
2025-05-14 08:36:47,274 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione d80ae985-57b5-4c3f-b419-b6ad6ea37f6f registrato con successo.
2025-05-14 08:36:47,275 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, client_ip_address, action_performed, 
                               table_name_affected, record_id_affected, details, success, timestamp)
    ... Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:36:47,278 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "client_ip_address" della relazione "audit_log" non esiste
LINE 2: ...  INSERT INTO audit_log (app_user_id, session_id, client_ip_...
                                                             ^

2025-05-14 08:36:47,283 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 08:36:47,284 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 08:36:47,284 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 08:36:50,018 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 08:36:50,019 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 08:36:50,020 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 08:36:50,127 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 08:36:50,128 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 08:36:50,129 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 08:36:53,627 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 08:36:54,021 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 610c8806-85e9-475f-ab98-d363437451f5
2025-05-14 08:36:54,025 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
    INSERT INTO audit_log (app_user_id, session_id, ip_address, action_performed,
                           table_name_affected, record_id_affected, details, success, "timestamp")
    VALUES (%s, %s... Errore: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^

2025-05-14 08:36:54,042 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGIN_SUCCESS'. Errore: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^

2025-05-14 08:36:54,048 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 610c8806-85e9-475f-ab98-d363437451f5
2025-05-14 08:36:54,048 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 610c8806-85e9-475f-ab98-d363437451f5) ha effettuato l'accesso al menu principale.
2025-05-14 08:38:48,763 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 610c8806-85e9-475f-ab98-d363437451f5...
2025-05-14 08:38:48,763 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 610c8806-85e9-475f-ab98-d363437451f5
2025-05-14 08:38:48,766 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 610c8806-85e9-475f-ab98-d363437451f5 registrato con successo.
2025-05-14 08:38:48,767 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
    INSERT INTO audit_log (app_user_id, session_id, ip_address, action_performed,
                           table_name_affected, record_id_affected, details, success, "timestamp")
    VALUES (%s, %s... Errore: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^

2025-05-14 08:38:48,770 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 3, Azione 'LOGOUT_SUCCESS'. Errore: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 26, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "action_performed" della relazione "audit_log" non esiste
LINE 2: ...O audit_log (app_user_id, session_id, ip_address, action_per...
                                                             ^

2025-05-14 08:38:48,773 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 08:38:48,774 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 08:38:48,774 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 08:56:48,756 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 08:56:48,760 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 08:56:48,760 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 08:56:48,851 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 08:56:48,852 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 08:56:48,854 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 08:56:54,631 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 08:56:54,984 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: b548edf8-3a02-433d-84c1-feac248cbb4b
2025-05-14 08:56:54,985 - CatastoAppLogger.UtentiService - ERROR - Errore durante l'aggiornamento post-login per utente sa: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 183, in login_user_service
    record_audit(db_manager, user_id, "LOGIN_SUCCESS", f"Utente {username} loggato.", "utenti", user_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 08:56:54,996 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-14 08:56:54,996 - CatastoAppLogger - ERROR - Errore durante il tentativo di login: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 183, in login_user_service
    record_audit(db_manager, user_id, "LOGIN_SUCCESS", f"Utente {username} loggato.", "utenti", user_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 95, in authenticate_user
    user_id, role_id, session_id, message = utenti_service.login_user_service(
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        db_manager_instance, username, password, client_ip_address
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 193, in login_user_service
    record_audit(db_manager, user_id, "LOGIN_FAIL", f"Errore setup sessione post-login: {str(e_session)[:100]}", "utenti", user_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 08:57:47,472 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 08:57:47,473 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:01:02,501 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:01:02,502 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:01:02,503 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:01:02,570 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:01:02,570 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:01:02,571 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:01:06,782 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:01:07,112 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 185472c9-510e-494a-8825-4f209adfce66
2025-05-14 09:01:07,121 - CatastoAppLogger.AuditService - INFO - Audit registrato: User 3, Azione 'LOGIN_SUCCESS', Successo: True, Dettagli: Utente sa loggato.
2025-05-14 09:01:07,121 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 185472c9-510e-494a-8825-4f209adfce66
2025-05-14 09:01:07,121 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 185472c9-510e-494a-8825-4f209adfce66) ha effettuato l'accesso al menu principale.
2025-05-14 09:01:16,855 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: SELECT id, nome, codice_catastale, provincia, regione, note FROM comuni ORDER BY nome... Errore: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-14 09:01:16,870 - CatastoAppLogger.AnagraficheService - ERROR - Errore durante il recupero dei comuni: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 67, in get_comuni_service
    comuni = db_manager.execute_query(query, params, fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "comuni" non esiste
LINE 1: ..., codice_catastale, provincia, regione, note FROM comuni ORD...
                                                             ^

2025-05-14 09:10:14,032 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 70, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-14 09:10:17,065 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 185472c9-510e-494a-8825-4f209adfce66...
2025-05-14 09:10:17,066 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 185472c9-510e-494a-8825-4f209adfce66
2025-05-14 09:10:17,082 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 185472c9-510e-494a-8825-4f209adfce66 registrato con successo.
2025-05-14 09:10:17,084 - CatastoAppLogger.UtentiService - ERROR - Errore durante il logout per utente ID 3: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:10:17,093 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-14 09:10:17,094 - CatastoAppLogger - ERROR - Errore durante il logout automatico: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 221, in main
    utenti_service.logout_user_service(db, logged_in_user_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 258, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_FAIL", f"Errore logout: {str(e)[:100]}", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:10:17,102 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 09:10:17,102 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:10:17,103 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 09:10:21,383 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:10:21,385 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:10:21,385 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:10:21,561 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:10:21,562 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:10:21,564 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:10:26,572 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:10:26,942 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: d1eb02ea-e255-4c0c-8637-9dd0159d8236
2025-05-14 09:10:26,945 - CatastoAppLogger.AuditService - INFO - Audit registrato: User 3, Azione 'LOGIN_SUCCESS', Successo: True, Dettagli: Utente sa loggato.
2025-05-14 09:10:26,945 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione d1eb02ea-e255-4c0c-8637-9dd0159d8236
2025-05-14 09:10:26,945 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: d1eb02ea-e255-4c0c-8637-9dd0159d8236) ha effettuato l'accesso al menu principale.
2025-05-14 09:10:39,459 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        SELECT s.id, s.comune_id, c.nome as nome_comune, s.nome_sezione, s.codice_sezione, s.note 
        FROM sezioni s 
        JOIN comuni c ON s.comune_id = c.id
     WHERE s.comune_id = %s ORDE... Errore: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^

2025-05-14 09:10:39,489 - CatastoAppLogger.AnagraficheService - ERROR - Errore recupero sezioni: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 237, in get_sezioni_service
    sezioni = db_manager.execute_query(query, tuple(params), fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^

2025-05-14 09:11:04,679 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 70, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-14 09:11:17,323 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        SELECT s.id, s.comune_id, c.nome as nome_comune, s.nome_sezione, s.codice_sezione, s.note 
        FROM sezioni s 
        JOIN comuni c ON s.comune_id = c.id
     WHERE s.comune_id = %s ORDE... Errore: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^

2025-05-14 09:11:17,326 - CatastoAppLogger.AnagraficheService - ERROR - Errore recupero sezioni: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 237, in get_sezioni_service
    sezioni = db_manager.execute_query(query, tuple(params), fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedTable: ERRORE:  la relazione "sezioni" non esiste
LINE 3:         FROM sezioni s 
                     ^

2025-05-14 09:11:20,486 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione d1eb02ea-e255-4c0c-8637-9dd0159d8236...
2025-05-14 09:11:20,486 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: d1eb02ea-e255-4c0c-8637-9dd0159d8236
2025-05-14 09:11:20,488 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione d1eb02ea-e255-4c0c-8637-9dd0159d8236 registrato con successo.
2025-05-14 09:11:20,489 - CatastoAppLogger.UtentiService - ERROR - Errore durante il logout per utente ID 3: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:11:20,495 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-14 09:11:20,496 - CatastoAppLogger - ERROR - Errore durante il logout automatico: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 221, in main
    utenti_service.logout_user_service(db, logged_in_user_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 258, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_FAIL", f"Errore logout: {str(e)[:100]}", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:11:20,504 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 09:11:20,505 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:11:20,505 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 09:28:18,266 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:28:18,267 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:28:18,267 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:28:18,333 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:28:18,334 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:28:18,335 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:28:21,982 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:28:22,319 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 3) loggato con successo. Sessione: 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58
2025-05-14 09:28:22,323 - CatastoAppLogger.AuditService - INFO - Audit registrato: User 3, Azione 'LOGIN_SUCCESS', Successo: True, Dettagli: Utente sa loggato.
2025-05-14 09:28:22,324 - CatastoAppLogger - INFO - Login successo per utente ID 3, Ruolo ID 2, Sessione 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58
2025-05-14 09:28:22,324 - CatastoAppLogger.MenuHandler - INFO - Utente ID 3 (Ruolo ID: 2, Sessione: 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58) ha effettuato l'accesso al menu principale.
2025-05-14 09:28:26,809 - CatastoDBLogger - ERROR - Errore Python generico durante l'esecuzione della query: tuple index out of range
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
IndexError: tuple index out of range
2025-05-14 09:28:26,841 - CatastoAppLogger.AnagraficheService - ERROR - Errore recupero sezioni: tuple index out of range
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 238, in get_sezioni_service
    sezioni = db_manager.execute_query(query, tuple(params), fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
IndexError: tuple index out of range
2025-05-14 09:28:37,348 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 70, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-14 09:32:19,738 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 3, sessione 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58...
2025-05-14 09:32:19,739 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 3, Sessione: 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58
2025-05-14 09:32:19,745 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 3, Sessione 6ca3b26c-aa5b-4c67-a8c5-a056e9813d58 registrato con successo.
2025-05-14 09:32:19,745 - CatastoAppLogger.UtentiService - ERROR - Errore durante il logout per utente ID 3: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:32:19,754 - CatastoDBLogger - INFO - Rollback della transazione eseguito.
2025-05-14 09:32:19,755 - CatastoAppLogger - ERROR - Errore durante il logout automatico: record_audit() got multiple values for argument 'session_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 243, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_SUCCESS", "Logout effettuato.", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 221, in main
    utenti_service.logout_user_service(db, logged_in_user_id, current_session_id, client_ip_address)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 258, in logout_user_service
    record_audit(db_manager, user_id, "LOGOUT_FAIL", f"Errore logout: {str(e)[:100]}", "sessioni_utente", session_id,
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 session_id=session_id, client_ip_address=client_ip_address, success=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'session_id'
2025-05-14 09:32:19,762 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 09:32:19,762 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:32:19,763 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 09:34:38,525 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:34:38,528 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:34:38,528 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:34:38,713 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:34:38,713 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:34:38,716 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:34:42,130 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:34:42,134 - CatastoAppLogger.UtentiService - WARNING - Utente non trovato: sa
2025-05-14 09:34:42,134 - CatastoAppLogger - ERROR - Errore durante il tentativo di login: record_audit() got multiple values for argument 'client_ip_address'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 95, in authenticate_user
    user_id, role_id, session_id, message = utenti_service.login_user_service(
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        db_manager_instance, username, password, client_ip_address
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 228, in login_user_service
    record_audit(db_manager, None, "LOGIN_FAIL", f"Utente non trovato: {username}.", "utenti",
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                 client_ip_address=client_ip_address, success=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: record_audit() got multiple values for argument 'client_ip_address'
2025-05-14 09:41:38,365 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 09:41:38,366 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:41:40,557 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:41:40,558 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:41:40,558 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:41:40,628 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:41:40,629 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:41:40,630 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:41:44,272 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:41:44,279 - CatastoAppLogger.UtentiService - WARNING - Utente non trovato: sa
2025-05-14 09:41:44,281 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, ip_address, action_performed,
                               table_name_affected, record_id_affected, details, success, "timestamp")
        VA... Errore: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^

2025-05-14 09:41:44,295 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User None, Azione 'LOGIN_FAIL'. Errore: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 29, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^

2025-05-14 09:42:15,315 - CatastoAppLogger.UtentiService - INFO - Tentativo di registrazione per l'utente: sa
2025-05-14 09:42:15,711 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 1) registrato con successo.
2025-05-14 09:42:15,712 - CatastoDBLogger - ERROR - Errore Database durante l'esecuzione della query: 
        INSERT INTO audit_log (app_user_id, session_id, ip_address, action_performed,
                               table_name_affected, record_id_affected, details, success, "timestamp")
        VA... Errore: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^

2025-05-14 09:42:15,714 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User 1, Azione 'REGISTER_USER_SUCCESS'. Errore: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 29, in record_audit
    db_manager.execute_query(query, (
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
        user_id, session_id, client_ip_address, action,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        table_name, record_id_str, details, success, datetime.now()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "app_user_id" della relazione "audit_log" non esiste
LINE 2:         INSERT INTO audit_log (app_user_id, session_id, ip_a...
                                       ^

2025-05-14 09:43:20,004 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 09:43:20,005 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 09:48:56,314 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 09:48:56,316 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 09:48:56,316 - CatastoDBLogger - INFO - Tentativo di connessione al database: catasto_storico@localhost
2025-05-14 09:48:56,397 - CatastoDBLogger - INFO - Connessione al database 'catasto_storico' riuscita.
2025-05-14 09:48:56,398 - CatastoDBLogger - INFO - Search path impostato a: catasto, public
2025-05-14 09:48:56,399 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 09:49:02,154 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 09:49:02,525 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 1) loggato con successo. Sessione: 092d7c2f-68e6-4031-8f46-9f1a0cb0b330
2025-05-14 09:49:02,527 - CatastoAppLogger - INFO - Login successo per utente ID 1, Ruolo ID 2, Sessione 092d7c2f-68e6-4031-8f46-9f1a0cb0b330
2025-05-14 09:49:02,528 - CatastoAppLogger.MenuHandler - INFO - Utente ID 1 (Ruolo ID: 2, Sessione: 092d7c2f-68e6-4031-8f46-9f1a0cb0b330) ha effettuato l'accesso al menu principale.
2025-05-14 09:49:07,975 - CatastoDBLogger - ERROR - Errore Python generico durante l'esecuzione della query: tuple index out of range
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
IndexError: tuple index out of range
2025-05-14 09:49:07,992 - CatastoAppLogger.AnagraficheService - ERROR - Errore recupero sezioni: tuple index out of range
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\anagrafiche_service.py", line 238, in get_sezioni_service
    sezioni = db_manager.execute_query(query, tuple(params), fetch_all=True)
  File "C:\Users\saint\catasto\acs\core\db_manager.py", line 181, in execute_query
    cur.execute(query, params)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 146, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
IndexError: tuple index out of range
2025-05-14 10:05:55,383 - CatastoAppLogger.MenuHandler - ERROR - Errore imprevisto durante l'operazione: search_partite_service() got an unexpected keyword argument 'current_user_id'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 70, in _handle_service_call
    result = service_function(db_manager, *args, **audit_params if audit_params else {}, **kwargs)
TypeError: search_partite_service() got an unexpected keyword argument 'current_user_id'
2025-05-14 10:05:58,296 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 1, sessione 092d7c2f-68e6-4031-8f46-9f1a0cb0b330...
2025-05-14 10:05:58,297 - CatastoAppLogger.UtentiService - INFO - Tentativo di logout per utente ID: 1, Sessione: 092d7c2f-68e6-4031-8f46-9f1a0cb0b330
2025-05-14 10:05:58,304 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 1, Sessione 092d7c2f-68e6-4031-8f46-9f1a0cb0b330 registrato con successo.
2025-05-14 10:05:58,306 - CatastoAppLogger - INFO - Chiusura connessione al database...
2025-05-14 10:05:58,307 - CatastoDBLogger - INFO - Disconnessione dal database riuscita.
2025-05-14 10:05:58,307 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
2025-05-14 11:37:14,755 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 11:37:14,758 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 11:40:07,288 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 11:40:07,289 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 11:40:07,407 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Pool di connessioni Psycopg2 (legacy) inizializzato.
2025-05-14 11:44:27,001 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 11:44:27,003 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 11:44:27,104 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Pool di connessioni Psycopg2 (legacy) inizializzato.
2025-05-14 11:44:27,114 - CatastoAppLogger - INFO - Pool di connessioni Psycopg2 (legacy) verificato con successo.
2025-05-14 11:44:27,116 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 11:44:33,354 - CatastoAppLogger.UtentiService - INFO - Tentativo di login per l'utente: sa
2025-05-14 11:44:33,881 - CatastoAppLogger.UtentiService - ERROR - Errore durante l'aggiornamento post-login per utente sa: 'DatabaseManager' object has no attribute 'conn'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 198, in login_user_service
    if db_manager.conn and db_manager.conn.isolation_level != psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT:
       ^^^^^^^^^^^^^^^
AttributeError: 'DatabaseManager' object has no attribute 'conn'
2025-05-14 11:44:33,887 - CatastoAppLogger - ERROR - Errore durante il tentativo di login: 'DatabaseManager' object has no attribute 'conn'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 198, in login_user_service
    if db_manager.conn and db_manager.conn.isolation_level != psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT:
       ^^^^^^^^^^^^^^^
AttributeError: 'DatabaseManager' object has no attribute 'conn'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 95, in authenticate_user
    user_id, role_id, session_id, message = utenti_service.login_user_service(
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        db_manager_instance, username, password, client_ip_address
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 216, in login_user_service
    if db_manager.conn and db_manager.conn.isolation_level != psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT:
       ^^^^^^^^^^^^^^^
AttributeError: 'DatabaseManager' object has no attribute 'conn'
2025-05-14 11:55:40,986 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 11:55:40,987 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Chiusura di tutte le connessioni nel pool Psycopg2 (legacy)...
2025-05-14 11:55:40,988 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Pool Psycopg2 (legacy) chiuso.
2025-05-14 12:05:14,111 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 12:05:14,113 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 12:05:14,219 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Pool di connessioni Psycopg2 (legacy) inizializzato.
2025-05-14 12:05:14,228 - CatastoAppLogger - INFO - Pool di connessioni Psycopg2 (legacy) verificato con successo.
2025-05-14 12:05:14,230 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 12:05:20,290 - CatastoAppLogger.UtentiService - INFO - Tentativo di login SQLAlchemy per l'utente: sa
2025-05-14 12:05:20,290 - CatastoAppLogger.UtentiService - ERROR - Errore DB SQLAlchemy durante il recupero utente 'sa' per login: 'DatabaseManager' object has no attribute 'query'
2025-05-14 12:09:42,947 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 12:09:42,947 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Chiusura di tutte le connessioni nel pool Psycopg2 (legacy)...
2025-05-14 12:09:42,948 - CatastoDBLogger.LegacyPsycopg2Manager - INFO - Pool Psycopg2 (legacy) chiuso.
2025-05-14 12:46:38,655 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 12:46:38,657 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 12:46:38,658 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 12:46:38,660 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 12:54:13,579 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 12:54:13,581 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 12:54:13,581 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 12:54:13,584 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 12:57:33,619 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 12:57:33,621 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 12:57:33,621 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 12:57:33,623 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 12:57:38,180 - CatastoAppLogger.UtentiService - INFO - Tentativo di login SQLAlchemy per l'utente: sa
2025-05-14 12:57:39,430 - CatastoAppLogger.UtentiService - ERROR - Errore SQLAlchemy durante commit post-login per utente sa: (psycopg2.errors.UndefinedColumn) ERRORE:  la colonna "user_agent" della relazione "sessioni_utente" non esiste
LINE 1: ...i_utente (user_id, session_id, client_ip_address, user_agent...
                                                             ^

[SQL: INSERT INTO sessioni_utente (user_id, session_id, client_ip_address, user_agent, login_time, logout_time, last_seen, is_active) VALUES (%(user_id)s, %(session_id)s, %(client_ip_address)s, %(user_agent)s, now(), %(logout_time)s, now(), %(is_active)s) RETURNING sessioni_utente.id, sessioni_utente.login_time, sessioni_utente.last_seen, sessioni_utente.data_creazione]
[parameters: {'user_id': 1, 'session_id': '5c9a8c22-22cf-43d6-9abf-7a8795354a70', 'client_ip_address': '192.168.0.188', 'user_agent': None, 'logout_time': None, 'is_active': True}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UndefinedColumn: ERRORE:  la colonna "user_agent" della relazione "sessioni_utente" non esiste
LINE 1: ...i_utente (user_id, session_id, client_ip_address, user_agent...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 141, in login_user_service
    db.commit() # Commette sia l'update di Utente.last_login sia l'insert di SessioneUtente
    ~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 4353, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 4488, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 4449, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1227, in _emit_insert_statements
    result = connection.execute(
        statement.values(value_params),
        params,
        execution_options=execution_options,
    )
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) ERRORE:  la colonna "user_agent" della relazione "sessioni_utente" non esiste
LINE 1: ...i_utente (user_id, session_id, client_ip_address, user_agent...
                                                             ^

[SQL: INSERT INTO sessioni_utente (user_id, session_id, client_ip_address, user_agent, login_time, logout_time, last_seen, is_active) VALUES (%(user_id)s, %(session_id)s, %(client_ip_address)s, %(user_agent)s, now(), %(logout_time)s, now(), %(is_active)s) RETURNING sessioni_utente.id, sessioni_utente.login_time, sessioni_utente.last_seen, sessioni_utente.data_creazione]
[parameters: {'user_id': 1, 'session_id': '5c9a8c22-22cf-43d6-9abf-7a8795354a70', 'client_ip_address': '192.168.0.188', 'user_agent': None, 'logout_time': None, 'is_active': True}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-05-14 13:14:27,534 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 13:14:33,246 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 13:14:33,248 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 13:14:33,248 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 13:14:33,252 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 13:14:37,989 - CatastoAppLogger.UtentiService - INFO - Tentativo di login SQLAlchemy per l'utente: sa
2025-05-14 13:14:37,999 - CatastoAppLogger.UtentiService - ERROR - Errore SQLAlchemy login utente sa: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'utente'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 146, in login_user_service
    utente_obj = db.query(Utente).filter(Utente.username == username).first()
                 ~~~~~~~~^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 276, in __init__
    self._set_entities(entities)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 289, in _set_entities
    coercions.expect(
    ~~~~~~~~~~~~~~~~^
        roles.ColumnsClauseRole,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        post_inspect=True,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ~~~~~~~~~^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4214, in _configure_registries
    _do_configure_registries(registries, cascade)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4255, in _do_configure_registries
    mapper._post_configure_properties()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
    ~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
    ~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
    ...<3 lines>...
    ) from err
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-05-14 13:14:38,182 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User None, Azione 'LOGIN_FAIL'. Errore: 'Session' object has no attribute 'execute_query'
Traceback (most recent call last):
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'utente'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 146, in login_user_service
    utente_obj = db.query(Utente).filter(Utente.username == username).first()
                 ~~~~~~~~^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 276, in __init__
    self._set_entities(entities)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 289, in _set_entities
    coercions.expect(
    ~~~~~~~~~~~~~~~~^
        roles.ColumnsClauseRole,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        post_inspect=True,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ~~~~~~~~~^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4214, in _configure_registries
    _do_configure_registries(registries, cascade)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4255, in _do_configure_registries
    mapper._post_configure_properties()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
    ~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
    ~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
    ...<3 lines>...
    ) from err
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 40, in record_audit
    db_manager.execute_query(query, (
    ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Session' object has no attribute 'execute_query'
2025-05-14 13:24:31,684 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 13:24:35,120 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 13:24:35,121 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 13:24:35,121 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 13:24:35,123 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 13:24:40,554 - CatastoAppLogger.UtentiService - INFO - Tentativo di login SQLAlchemy per l'utente: sa
2025-05-14 13:24:40,565 - CatastoAppLogger.UtentiService - ERROR - Errore SQLAlchemy login utente sa: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente_associato'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'utente_associato'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 146, in login_user_service
    utente_obj = db.query(Utente).filter(Utente.username == username).first()
                 ~~~~~~~~^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 276, in __init__
    self._set_entities(entities)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 289, in _set_entities
    coercions.expect(
    ~~~~~~~~~~~~~~~~^
        roles.ColumnsClauseRole,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        post_inspect=True,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ~~~~~~~~~^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4214, in _configure_registries
    _do_configure_registries(registries, cascade)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4255, in _do_configure_registries
    mapper._post_configure_properties()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
    ~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
    ~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
    ...<3 lines>...
    ) from err
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente_associato'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-05-14 13:24:40,746 - CatastoAppLogger.AuditService - ERROR - FALLIMENTO REGISTRAZIONE AUDIT: User None, Azione 'LOGIN_FAIL'. Errore: 'Session' object has no attribute 'execute_query'
Traceback (most recent call last):
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2522, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'utente_associato'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 146, in login_user_service
    utente_obj = db.query(Utente).filter(Utente.username == username).first()
                 ~~~~~~~~^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py", line 2955, in query
    return self._query_cls(entities, self, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 276, in __init__
    self._set_entities(entities)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py", line 289, in _set_entities
    coercions.expect(
    ~~~~~~~~~~~~~~~~^
        roles.ColumnsClauseRole,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        post_inspect=True,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\coercions.py", line 388, in expect
    insp._post_inspect
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1257, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ~~~~~~~~~^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2724, in _post_inspect
    self._check_configure()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4214, in _configure_registries
    _do_configure_registries(registries, cascade)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4255, in _do_configure_registries
    mapper._post_configure_properties()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2418, in _post_configure_properties
    prop.init()
    ~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 589, in init
    self.do_init()
    ~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1661, in do_init
    self._generate_backref()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2147, in _generate_backref
    self._add_reverse_property(self.back_populates)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1592, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "C:\Users\saint\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2524, in get_property
    raise sa_exc.InvalidRequestError(
    ...<3 lines>...
    ) from err
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[SessioneUtente(sessioni_utente)]' has no property 'utente_associato'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\audit_service.py", line 40, in record_audit
    db_manager.execute_query(query, (
    ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Session' object has no attribute 'execute_query'
2025-05-14 13:26:40,888 - CatastoAppLogger - INFO - Autenticazione fallita o utente ha scelto di uscire. Chiusura applicazione.
2025-05-14 13:26:45,378 - CatastoAppLogger - INFO - Avvio Applicazione Catasto Storico...
2025-05-14 13:26:45,379 - CatastoAppLogger.ConfigLoader - INFO - Configurazione database caricata da 'config.ini'.
2025-05-14 13:26:45,380 - CatastoAppLogger - INFO - Sessione SQLAlchemy creata e pronta.
2025-05-14 13:26:45,383 - CatastoAppLogger - INFO - Indirizzo IP client rilevato/usato: 192.168.0.188
2025-05-14 13:26:48,758 - CatastoAppLogger.UtentiService - INFO - Tentativo di login SQLAlchemy per l'utente: sa
2025-05-14 13:26:49,815 - CatastoAppLogger.UtentiService - INFO - Utente 'sa' (ID: 1) loggato (SQLAlchemy). Sessione: 3f3df5e6-b271-4cc6-acff-6abcf24d65b0
2025-05-14 13:26:49,816 - CatastoAppLogger - INFO - Accesso al menu principale...
2025-05-14 13:26:49,816 - CatastoAppLogger.MenuHandler - INFO - Utente ID <sqlalchemy.orm.session.Session object at 0x000001E1B594DE80> (Ruolo ID: 1, Sessione: 2) al menu principale.
2025-05-14 13:26:56,018 - CatastoAppLogger.AnagraficheService - INFO - Recupero lista comuni tramite SQLAlchemy.
2025-05-14 13:26:57,172 - CatastoAppLogger.AnagraficheService - INFO - Recupero sezioni (comune ID: 1) tramite SQLAlchemy.
2025-05-14 13:27:22,998 - CatastoAppLogger.UtentiService - INFO - Tentativo logout SQLAlchemy per utente ID: <sqlalchemy.orm.session.Session object at 0x000001E1B594DE80>, Sessione: 2
2025-05-14 13:27:22,999 - CatastoAppLogger - ERROR - Errore non gestito nel ciclo principale dell'applicazione: 'str' object has no attribute 'rollback'
Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 208, in logout_user_service
    session_obj = db.query(SessioneUtente).filter(
                  ^^^^^^^^
AttributeError: 'str' object has no attribute 'query'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\saint\catasto\acs\main_app.py", line 249, in main
    menu_principale(db_sqla_session,
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
                    logged_in_user_id,
                    ^^^^^^^^^^^^^^^^^^
                    current_user_role_id,
                    ^^^^^^^^^^^^^^^^^^^^^
                    current_session_id,
                    ^^^^^^^^^^^^^^^^^^^
                    client_ip_address)
                    ^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\ui\console\menu_handler.py", line 651, in menu_principale
    if utenti_service.logout_user_service(db_manager_old_instance, logged_in_user_id, current_session_id, client_ip_address):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\saint\catasto\acs\core\services\utenti_service.py", line 233, in logout_user_service
    db.rollback()
    ^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'rollback'
2025-05-14 13:27:23,074 - CatastoAppLogger - INFO - Esecuzione logout per utente ID 1, sessione 3f3df5e6-b271-4cc6-acff-6abcf24d65b0...
2025-05-14 13:27:23,074 - CatastoAppLogger.UtentiService - INFO - Tentativo logout SQLAlchemy per utente ID: 1, Sessione: 3f3df5e6-b271-4cc6-acff-6abcf24d65b0
2025-05-14 13:27:23,104 - CatastoAppLogger.UtentiService - INFO - Logout utente ID 1, Sessione 3f3df5e6-b271-4cc6-acff-6abcf24d65b0 registrato (SQLAlchemy).
2025-05-14 13:27:23,104 - CatastoAppLogger - INFO - Chiusura sessione SQLAlchemy...
2025-05-14 13:27:23,105 - CatastoAppLogger - INFO - Applicazione Catasto Storico terminata.
